<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>Payment Token | Magento 2 Developer Documentation</title>
	<meta name="description" content="Magento 2 Developer Documentation.
">

	<link rel="stylesheet" href="/assets/css/app.css" />
	<link rel="stylesheet" href="/assets/css/print.css" media="print"/>

	<link rel="stylesheet" href="/common/css/devdocs.css" />

	<script>
  var baseUrl = "";
  var algolia = {
    id : "E642SEDTHL",
    index:  "devdocs",
    key:  "d2d0f33ab73e291ef8d88d8b565e754c"
  };
</script>



<!-- Google Analytics -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-66243208-1', 'auto');
    ga('send', 'pageview');
</script>

<!-- Hotjar Tracking Code for http://devdocs.magento.com/ -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:806243,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>

<!-- heap analytics -->
<script type="text/javascript">
      window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
      heap.load("2619540280");
</script>




	<link rel="canonical" href="/guides/v2.3/payments-integrations/vault/payment-token.html">

	<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://magento.com/favicon.ico">
	<link rel="apple-touch-icon" type="image/png" href="https://magento.com/apple-touch-icon.png">
	<link rel="apple-touch-icon" type="image/png" sizes="57x57" href="https://magento.com/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" type="image/png" sizes="72x72" href="https://magento.com/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://magento.com/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" type="image/png" sizes="114x114" href="https://magento.com/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://magento.com/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="https://magento.com/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://magento.com/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://magento.com/apple-touch-icon-180x180.png">

</head>
<body class="layout-default">

	<header class="site-header">

		<nav class="site-nav">

  <div class="menu-btn">
    <a id="menu-btn" class="menu-trigger menu-icon" href="#nav-main" aria-haspopup="true" aria-controls="nav-main"></a>
  </div>

  <div class="nav-container">

    <a class="logo" href="/guides/v2.3/">
      <img src="/assets/i/m-logo.svg" alt=""><img src="/assets/i/magento-logo.svg" alt="Magento" class="magento-logo" />
      <span class="site-logo">DevDocs</span>
    </a>

    <div id="nav-main" class="nav-main-wrap" aria-labelledby="menu-btn">
      
<div class="version-switcher dropdown" data-version="2.3">
	<button id="version-switcher-button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Magento 2.3 Pre-release
	</button>

	<ul class="dropdown-menu dropdown-menu-left" aria-labelledby="version-switcher-button">
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.0/payments-integrations/vault/payment-token.html">Magento 2.0</a></li>
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.1/payments-integrations/vault/payment-token.html">Magento 2.1</a></li>
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.2/payments-integrations/vault/payment-token.html">Magento 2.2</a></li>
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.3/payments-integrations/vault/payment-token.html">Magento 2.3 Pre-release</a></li>
	
  </ul>

</div>


      <!-- Main Navigation -->
<ul class="nav-main" role="menubar">

  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Setup</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
          <li><a href="/guides/v2.3/install-gde/bk-install-guide.html">Installation Guide</a></li>
          
          <li><a href="/guides/v2.3/config-guide/bk-config-guide.html">Configuration Guide</a></li>
          
          <li><a href="/guides/v2.3/performance-best-practices/index.html">Performance Best Practices</a></li>
          
          <li><a href="/guides/v2.3/migration/bk-migration-guide.html">Migration Guide</a></li>
          <li><a href="/guides/v2.3/cloud/bk-cloud.html">Magento Commerce (Cloud) Guide</a></li>
          <li><a href="/magento-release-information.html">Release Information</a></li>
      </ul>
    </div>

  </li>


  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Development</span>

    <div class="nav-popup" role="menu" aria-hidden="true">

      <div class="nav-section">
        <div class="nav-section-title">Backend</div>
        <ul>
          <li><a href="/guides/v2.3/architecture/bk-architecture.html">Architecture Guide</a></li>
          <li><a href="/guides/v2.3/extension-dev-guide/bk-extension-dev-guide.html">PHP Developer Guide</a></li>
          <li><a href="/guides/v2.3/ext-best-practices/bk-ext-best-practices.html">Extension Developer Best Practices</a></li>
          <li><a href="/guides/v2.3/mrg/intro.html">Module Reference Guide</a></li>
          <li><a href="/guides/v2.3/coding-standards/bk-coding-standards.html">Coding Standards</a></li>
          <li><a href="/guides/v2.3/contributor-guide/contributing.html">Contributor Guide</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Frontend</div>
        <ul>
          <li class=""><a href="/guides/v2.3/frontend-dev-guide/bk-frontend-dev-guide.html">Frontend Developer Guide</a></li>
          
          <li><a href="/guides/v2.3/ui_comp_guide/bk-ui_comps.html">UI Components Guide</a></li>
          
          <li><a href="/guides/v2.3/javascript-dev-guide/bk-javascript-dev-guide.html">JavaScript Developer Guide</a></li>
          <li><a href="/guides/v2.3/pattern-library/bk-pattern.html">Admin Design Pattern Library</a></li>
          <li><a href="/guides/v2.3/design-styleguide/bk-styleguide.html">Admin Style Guide</a></li>
          <li><a href="https://magento-research.github.io/pwa-devdocs/">PWA Studios</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title"><abbr>API</abbr></div>
        <ul>
          <li><a href="/guides/v2.3/get-started/bk-get-started-api.html">Get Started with Magento Web APIs</a></li>
          <li><a href="/guides/v2.3/rest/bk-rest.html">REST API Reference</a></li>
          <li><a href="/guides/v2.3/soap/bk-soap.html">SOAP API Reference</a></li>
          
          <li><a href="/guides/v2.3/graphql/index.html">GraphQL Developer Guide (New!)</a></li>
          
          
          <li><a href="/guides/v2.3/marketplace/eqp/api.html">Marketplace EQP API Reference</a></li>
          
        </ul>
      </div>
    </div>

  </li>


  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Testing</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
        <li><a href="/guides/v2.3/test/testing.html">Magento Testing Guide</a></li>
        
        <li><a href="/guides/v2.3/magento-functional-testing-framework/release-2/introduction.html">Functional Acceptance Testing (New!)</a></li>
        
        <li><a href="/guides/v2.3/mtf/mtf_introduction.html">Functional Testing</a></li>
        <li><a href="/guides/v2.3/test/integration/integration_test_execution.html">Integration Testing</a></li>
        <li><a href="/guides/v2.3/test/js/jasmine.html">JavaScript Unit Testing</a></li>
        <li><a href="/guides/v2.3/test/unit/unit_test_execution.html">PHP Unit Testing</a></li>
        <li><a href="/guides/v2.3/get-started/web-api-functional-testing.html">Web API Functional Testing</a></li>
      </ul>
    </div>

  </li>


  <li class="nav-main-separator"></li>


  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Functional Areas</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
          
          <li class="leaf"><a href="/guides/v2.3/advanced-reporting/overview.html">Advanced Reporting</a></li>
          
        
        <li class="leaf"><a href="/guides/v2.3/b2b/bk-b2b.html">B2B</a></li>
        
        <li><a href="/guides/v2.3/howdoi/checkout/checkout_overview.html">Checkout</a></li>
        <li><a href="/guides/v2.3/payments-integrations/bk-payments-integrations.html">Payment Integrations</a></li>
        
          <li><a href="/guides/v2.3/extension-dev-guide/staging.html">Staging</a></li>
        
      </ul>
    </div>

  </li>


  <li class="nav-main-item"  tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Tutorials</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
        <li><a href="/guides/v2.3/howdoi/bk-how-do-i.html">How To</a></li>
        
        <li><a  data-proofer-ignore href="/guides/v2.3/get-started/order-tutorial/order-intro.html">Order Processing with REST APIs</a></li>
        

        <li><a href="/videos/">Video Tutorials</a></li>
      </ul>
    </div>

  </li>

</ul><!-- /.nav-main -->

    </div>

    <div class="search-btn">
      <a class="search-trigger search-icon" href="#"></a>
    </div>

    <form class="quick-search" action="/guides/v2.3/search.html" method="get" novalidate="novalidate">
      <input type="search" name="q" placeholder="Search" />
      <a href="#" class="quick-search-close">&times;</a>
    </form>

  </div>

</nav><!-- #site-nav -->
<div class="nav-main-fader"></div>


	</header>

	<div class="global-wrapper">

		<div class="main-container">
			<a id="main-content"></a>


<div class="content-container">

    
    <div class="message-banner">
        This is the 2.3 Alpha release version of Magento documentation. Content in this version is subject to change.
    </div>
    

	<!-- sidebar -->
<aside class="sidebar">
	<a href="#" data-proofer-ignore class="toc-toggler">Table of Contents</a>
	<div class="sidebar-wrapper">

		

		<h4 class="guide-title">Payment Provider Gateway</h4>
		<div class="collapsible-navigation">
		    <ul>
		    
		    	

<li class="nav-level1  " id="introduction">
    

    
    <a href="/guides/v2.3/payments-integrations/bk-payments-integrations.html">Introduction</a>
    

    
</li>


		    
		    	

<li class="nav-level1  " id="magento-payment-provider-gateway">
    

    
    <a href="/guides/v2.3/payments-integrations/payment-gateway/payment-gateway-intro.html">Magento payment provider gateway</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="payment-provider-gateway-structure">

            

            
            <a href="/guides/v2.3/payments-integrations/payment-gateway/payment-gateway-structure.html">Payment provider gateway structure</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="gateway-command">

            

            
            <a href="/guides/v2.3/payments-integrations/payment-gateway/gateway-command.html">Gateway Command</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="gateway-command-pool">

            

            
            <a href="/guides/v2.3/payments-integrations/payment-gateway/command-pool.html">Gateway Command Pool</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="request-builder">

            

            
            <a href="/guides/v2.3/payments-integrations/payment-gateway/request-builder.html">Request Builder</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="gateway-client">

            

            
            <a href="/guides/v2.3/payments-integrations/payment-gateway/gateway-client.html">Gateway Client</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="response-validator">

            

            
            <a href="/guides/v2.3/payments-integrations/payment-gateway/response-validator.html">Response Validator</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="response-handler">

            

            
            <a href="/guides/v2.3/payments-integrations/payment-gateway/response-handler.html">Response Handler</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="error-code-mapping">

            

            
            <a href="/guides/v2.3/payments-integrations/payment-gateway/error-code-mapper.html">Error Code Mapping</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="adding-a-new-payment-integration-(payment-method)">
    

    
    <a href="/guides/v2.3/payments-integrations/base-integration/integration-intro.html">Adding a new payment integration (payment method)</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="payment-method-module-configuration">

            

            
            <a href="/guides/v2.3/payments-integrations/base-integration/module-configuration.html">Payment method module configuration</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="payment-method-configuration">

            

            
            <a href="/guides/v2.3/payments-integrations/base-integration/payment-option-config.html">Payment method configuration</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="payment-method-facade">

            

            
            <a href="/guides/v2.3/payments-integrations/base-integration/facade-configuration.html">Payment method facade</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="payment-info-rendering-in-admin-checkout">

            

            
            <a href="/guides/v2.3/payments-integrations/base-integration/formblocktype.html">Payment info rendering in Admin checkout</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="add-a-payment-action">

            

            
            <a href="/guides/v2.3/payments-integrations/base-integration/payment-action.html">Add a payment action</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="get-payment-information-from-frontend-to-backend">

            

            
            <a href="/guides/v2.3/payments-integrations/base-integration/get-payment-info.html">Get payment information from frontend to backend</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="configure-payment-method-by-area">

            

            
            <a href="/guides/v2.3/payments-integrations/base-integration/admin-integration.html">Configure payment method by area</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="adding-vault-integration">
    

    
    <a href="/guides/v2.3/payments-integrations/vault/vault-intro.html">Adding vault integration</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="add-vault-to-module-dependencies">

            

            
            <a href="/guides/v2.3/payments-integrations/vault/module-configuration.html">Add vault to module dependencies</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="vault-payment-configuration">

            

            
            <a href="/guides/v2.3/payments-integrations/vault/vault-payment-configuration.html">Vault payment configuration</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="vault-di-configuration">

            

            
            <a href="/guides/v2.3/payments-integrations/vault/vault-di.html">Vault DI configuration</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="enable-vault">

            

            
            <a href="/guides/v2.3/payments-integrations/vault/enabler.html">Enable vault</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2 active " id="payment-token">

            

            
            <a href="/guides/v2.3/payments-integrations/vault/payment-token.html">Payment Token</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="token-ui-component-provider">

            

            
            <a href="/guides/v2.3/payments-integrations/vault/token-ui-component-provider.html">Token UI component provider</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="display-the-stored-information">

            

            
            <a href="/guides/v2.3/payments-integrations/vault/customer-stored-payments.html">Display the stored information</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="vault-implementation-for-admin">

            

            
            <a href="/guides/v2.3/payments-integrations/vault/admin-integration.html">Vault implementation for Admin</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="signifyd-fraud-protection">
    

    
    <a href="/guides/v2.3/payments-integrations/signifyd/signifyd.html">Signifyd fraud protection</a>
    

    
</li>


		    
		    </ul>
		</div>

	</div>

</aside>
<!-- /sidebar -->


	<section class="content">
		<div class="content-wrap">
			<!-- page-header -->
<section class="page-intro">
	

  <nav class="breadcrumbs">

    <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      <li class="breadcrumb-item"><a class="breadcrumb-item" href="/guides/v2.3/"><span>Home</span></a></li>

    <!-- Iteration breadcrumb item -->
    
    

    

      <!-- Skip if root -->
      

      <!-- Get breadcrumb title -->
      

      <!-- SEO data -->
      

      <li class="breadcrumb-item active" property="itemListElement" typeof="ListItem">

        

          

          <span property="name">Payment Token</span>

        

        <meta property="position" content="1" />
      </li>

    

    </ol>

  </nav>



	

	

	<h1 class="page-heading">Payment Token</h1>

  


</section>

			<p>Magento does not store any private credit card details. It only stores the data received from the payment provider: payment processor token and credit card details without sensitive data.</p>

<p>This information is stored in Payment Token.</p>

<p>The basic interface for Payment Token is <a href="https://github.com/magento/magento2/blob/2.1//app/code/Magento/Vault/Api/Data/PaymentTokenInterface.php">PaymentTokenInterface</a>.</p>

<p>To retrieve and store token details, you need to implement a <a href="/guides/v2.3/payments-integrations/payment-gateway/response-handler.html">response handler</a>. In the response handler a Payment Token <span term-uuid="a9027f5d-efab-4662-96aa-c2999b5ab259" class="glossary-term" data-toggle="popover">entity</span> is created and stored in the payment <span term-uuid="55774db9-bf9d-40f3-83db-b10cc5ae3b68" class="glossary-term" data-toggle="popover">extension</span> attributes.</p>

<p>Following sample is an example of the response handler implementation:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">use</span> <span class="nx">Magento\Vault\Api\Data\PaymentTokenFactoryInterface</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Magento\Vault\Api\Data\PaymentTokenInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">VaultDetailsHandler</span> <span class="k">implements</span> <span class="nx">HandlerInterface</span>
<span class="p">{</span>
    <span class="sd">/**
     * @inheritdoc
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="k">array</span> <span class="nv">$handlingSubject</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$response</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$paymentDO</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">subjectReader</span><span class="o">-&gt;</span><span class="na">readPayment</span><span class="p">(</span><span class="nv">$handlingSubject</span><span class="p">);</span>
        <span class="nv">$transaction</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">subjectReader</span><span class="o">-&gt;</span><span class="na">readTransaction</span><span class="p">(</span><span class="nv">$response</span><span class="p">);</span>
        <span class="nv">$payment</span> <span class="o">=</span> <span class="nv">$paymentDO</span><span class="o">-&gt;</span><span class="na">getPayment</span><span class="p">();</span>

        <span class="c1">// add vault payment token entity to extension attributes
</span>        <span class="nv">$paymentToken</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getVaultPaymentToken</span><span class="p">(</span><span class="nv">$transaction</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">!==</span> <span class="nv">$paymentToken</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$extensionAttributes</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getExtensionAttributes</span><span class="p">(</span><span class="nv">$payment</span><span class="p">);</span>
            <span class="nv">$extensionAttributes</span><span class="o">-&gt;</span><span class="na">setVaultPaymentToken</span><span class="p">(</span><span class="nv">$paymentToken</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Get vault payment token entity
     *
     * @param \Braintree\Transaction $transaction
     * @return PaymentTokenInterface|null
     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">getVaultPaymentToken</span><span class="p">(</span><span class="nx">Transaction</span> <span class="nv">$transaction</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Check token existing in gateway response
</span>        <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">creditCardDetails</span><span class="o">-&gt;</span><span class="na">token</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$token</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="sd">/** @var PaymentTokenInterface $paymentToken */</span>
        <span class="nv">$paymentToken</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">paymentTokenFactory</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="nx">PaymentTokenFactoryInterface</span><span class="o">::</span><span class="na">TOKEN_TYPE_CREDIT_CARD</span><span class="p">);</span>
        <span class="nv">$paymentToken</span><span class="o">-&gt;</span><span class="na">setGatewayToken</span><span class="p">(</span><span class="nv">$token</span><span class="p">);</span>

        <span class="nv">$paymentToken</span><span class="o">-&gt;</span><span class="na">setTokenDetails</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">convertDetailsToJSON</span><span class="p">([</span>
            <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getCreditCardType</span><span class="p">(</span><span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">creditCardDetails</span><span class="o">-&gt;</span><span class="na">cardType</span><span class="p">),</span>
            <span class="s1">'maskedCC'</span> <span class="o">=&gt;</span> <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">creditCardDetails</span><span class="o">-&gt;</span><span class="na">last4</span><span class="p">,</span>
            <span class="s1">'expirationDate'</span> <span class="o">=&gt;</span> <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">creditCardDetails</span><span class="o">-&gt;</span><span class="na">expirationDate</span>
        <span class="p">]));</span>

        <span class="k">return</span> <span class="nv">$paymentToken</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>There are two available types of payment tokens:</p>

<ul>
  <li><code class="highlighter-rouge">\Magento\Vault\Api\Data\PaymentTokenFactoryInterface::TOKEN_TYPE_CREDIT_CARD</code> is used for credit cards</li>
  <li><code class="highlighter-rouge">\Magento\Vault\Api\Data\PaymentTokenFactoryInterface::TOKEN_TYPE_ACCOUNT</code> is used for payment accounts like PayPal</li>
</ul>

<p>Depending on your payment integration, you need to specify one of them to create a payment token.</p>

<p>Also, you can create own type of payment token.
But in that case you must re-define the <code class="highlighter-rouge">tokenTypes</code> argument for <code class="highlighter-rouge">\Magento\Vault\Model\PaymentTokenFactory</code> in <code class="highlighter-rouge">di.xml</code> (not just replacing with argument but appending your token type to existing to avoid breaking existing functionality) or provide own preference for <code class="highlighter-rouge">\Magento\Vault\Api\Data\PaymentTokenFactoryInterface</code>.</p>

<p>The important thing is the <code class="highlighter-rouge">setGatewayToken()</code> method. This method gets the gateway token: a hashed value based on some credit card details.
Different payment providers use different algorithms to create this hash. In most cases, exactly this token is used to perform place order actions.</p>

<p>The created response handler must be added to the handler chain in the DI configuration file <code class="highlighter-rouge">di.xml</code>.</p>

<p>Example of the Braintriee <code class="highlighter-rouge">di.xml</code>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;virtualType</span> <span class="na">name=</span><span class="s">"BraintreeAuthorizationHandler"</span> <span class="na">type=</span><span class="s">"Magento\Payment\Gateway\Response\HandlerChain"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;arguments&gt;</span>
        <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"handlers"</span> <span class="na">xsi:type=</span><span class="s">"array"</span><span class="nt">&gt;</span>
            ...
            <span class="nt">&lt;item</span> <span class="na">name=</span><span class="s">"vault_details"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>Magento\Braintree\Gateway\Response\VaultDetailsHandler<span class="nt">&lt;/item&gt;</span>
            ...
        <span class="nt">&lt;/argument&gt;</span>
    <span class="nt">&lt;/arguments&gt;</span>
<span class="nt">&lt;/virtualType&gt;</span>
</code></pre></div></div>

<p>The persistence layer for Payment Token is implemented in the <a href="https://github.com/magento/magento2/blob/2.1/app/code/Magento/Vault">Vault Module</a>.</p>

<h2 id="whats-next">What’s next</h2>
<p><a href="/guides/v2.3/payments-integrations/vault/token-ui-component-provider.html">Adding and using  UI_Vault component to place orders on the storefront</a>.</p>

			
		</div>
		<!-- /.content-wrap -->

		<div class="page-info">

    
  
    
    <div class="github-link">
      <a class="improve-page" href="https://github.com/magento/devdocs/blob/develop/guides/v2.3/payments-integrations/vault/payment-token.md" target="_blank">
        Edit this page on GitHub
      </a>
    </div>
    
  
    
    <div class="new-issue">
      <a href="https://github.com/magento/devdocs/issues/new?title=Feedback on page: /guides/v2.3/payments-integrations/vault/payment-token.html" target="_blank">Give us feedback</a>
    </div>
    
  
  </div>

	</section>
	<!-- /.content -->

</div> <!-- /.content-container -->


	</div>
	<!-- /.main-container -->
</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div class="page-footer">
  <div class="container">

    <div class="copyright-links">
      <ul class="nav footer-links">
  <li><a href="/guides/v2.3/contributor-guide/contributing_docs.html">Become a Contributor</a>
  <li><a href="https://magento.github.io/glossary/index.html?audience=developer">Glossary</a></li>
  <li><a href="http://magento.com/legal/terms/privacy/">Privacy Policy</a></li>
  <li><a href="http://magento.com/legal/terms/">Terms of Service</a></li>
  <li><a href="http://magento.com/legal/licensing/">License/Trademark FAQ</a></li>
  <li><a href="/guides/v2.3/release-notes/bk-release-notes.html">Release Notes</a></li>
  <li><a href="/magento-third-party.html">Third-Party Licenses</a></li>
</ul>

    </div>

		<div class="copyright-date">&copy; 2018 Magento. All rights reserved.</div>

  </div>
</div>
<!-- / #footer -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="/assets/js/app.min.js"></script>


<script src="/common/js/devdocs.min.js"></script>



<script type="text/javascript">
    (function() {
        var didInit = false;
        function initMunchkin() {
            if(didInit === false) {
                didInit = true;
                Munchkin.init('585-GGD-959', {cookieAnon: false});
            }
        }
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.async = true;
        s.src = '//munchkin.marketo.net/munchkin.js';
        s.onreadystatechange = function() {
            if (this.readyState == 'complete' || this.readyState == 'loaded') {
                initMunchkin();
            }
        };
        s.onload = initMunchkin;
        document.getElementsByTagName('head')[0].appendChild(s);
    })();
</script>




</body>
</html>
