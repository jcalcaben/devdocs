<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>Error Code Mapping | Magento 2 Developer Documentation</title>
	<meta name="description" content="Magento 2 Developer Documentation.
">

	<link rel="stylesheet" href="/assets/css/app.css" />
	<link rel="stylesheet" href="/assets/css/print.css" media="print"/>

	<link rel="stylesheet" href="/common/css/devdocs.css" />

	<script>
  var baseUrl = "";
  var algolia = {
    id : "E642SEDTHL",
    index:  "devdocs",
    key:  "d2d0f33ab73e291ef8d88d8b565e754c"
  };
</script>



<!-- Google Analytics -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-66243208-1', 'auto');
    ga('send', 'pageview');
</script>

<!-- Hotjar Tracking Code for http://devdocs.magento.com/ -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:806243,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>

<!-- heap analytics -->
<script type="text/javascript">
      window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
      heap.load("2619540280");
</script>




	<link rel="canonical" href="/guides/v2.2/payments-integrations/payment-gateway/error-code-mapper.html">

	<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://magento.com/favicon.ico">
	<link rel="apple-touch-icon" type="image/png" href="https://magento.com/apple-touch-icon.png">
	<link rel="apple-touch-icon" type="image/png" sizes="57x57" href="https://magento.com/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" type="image/png" sizes="72x72" href="https://magento.com/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://magento.com/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" type="image/png" sizes="114x114" href="https://magento.com/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://magento.com/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="https://magento.com/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://magento.com/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://magento.com/apple-touch-icon-180x180.png">

</head>
<body class="layout-default">

	<header class="site-header">

		<nav class="site-nav">

  <div class="menu-btn">
    <a id="menu-btn" class="menu-trigger menu-icon" href="#nav-main" aria-haspopup="true" aria-controls="nav-main"></a>
  </div>

  <div class="nav-container">

    <a class="logo" href="/">
      <img src="/assets/i/m-logo.svg" alt=""><img src="/assets/i/magento-logo.svg" alt="Magento" class="magento-logo" />
      <span class="site-logo">DevDocs</span>
    </a>

    <div id="nav-main" class="nav-main-wrap" aria-labelledby="menu-btn">
      
<div class="version-switcher dropdown" data-version="2.2">
	<button id="version-switcher-button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    Magento 2.2
	</button>

	<ul class="dropdown-menu dropdown-menu-left" aria-labelledby="version-switcher-button">
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.0/payments-integrations/payment-gateway/error-code-mapper.html">Magento 2.0</a></li>
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.1/payments-integrations/payment-gateway/error-code-mapper.html">Magento 2.1</a></li>
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.2/payments-integrations/payment-gateway/error-code-mapper.html">Magento 2.2</a></li>
	
		<li><a class="dropdown-item" data-proofer-ignore href="/guides/v2.3/payments-integrations/payment-gateway/error-code-mapper.html">Magento 2.3 Pre-release</a></li>
	
  </ul>

</div>


      <!-- Main Navigation -->
<ul class="nav-main" role="menubar">

  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Setup</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
          <li><a href="/guides/v2.2/install-gde/bk-install-guide.html">Installation Guide</a></li>
          
          <li><a href="/guides/v2.2/comp-mgr/bk-compman-upgrade-guide.html">Extension Update and System Upgrade Guide</a></li>
          
          <li><a href="/guides/v2.2/config-guide/bk-config-guide.html">Configuration Guide</a></li>
          
          <li><a href="/guides/v2.2/performance-best-practices/index.html">Performance Best Practices</a></li>
          
          <li><a href="/guides/v2.2/migration/bk-migration-guide.html">Migration Guide</a></li>
          <li><a href="/guides/v2.2/cloud/bk-cloud.html">Magento Commerce (Cloud) Guide</a></li>
          <li><a href="/magento-release-information.html">Release Information</a></li>
      </ul>
    </div>

  </li>


  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Development</span>

    <div class="nav-popup" role="menu" aria-hidden="true">

      <div class="nav-section">
        <div class="nav-section-title">Backend</div>
        <ul>
          <li><a href="/guides/v2.2/architecture/bk-architecture.html">Architecture Guide</a></li>
          <li><a href="/guides/v2.2/extension-dev-guide/bk-extension-dev-guide.html">PHP Developer Guide</a></li>
          <li><a href="/guides/v2.2/ext-best-practices/bk-ext-best-practices.html">Extension Developer Best Practices</a></li>
          <li><a href="/guides/v2.2/mrg/intro.html">Module Reference Guide</a></li>
          <li><a href="/guides/v2.2/coding-standards/bk-coding-standards.html">Coding Standards</a></li>
          <li><a href="/guides/v2.2/contributor-guide/contributing.html">Contributor Guide</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Frontend</div>
        <ul>
          <li class=""><a href="/guides/v2.2/frontend-dev-guide/bk-frontend-dev-guide.html">Frontend Developer Guide</a></li>
          
          <li><a href="/guides/v2.2/ui_comp_guide/bk-ui_comps.html">UI Components Guide</a></li>
          
          <li><a href="/guides/v2.2/javascript-dev-guide/bk-javascript-dev-guide.html">JavaScript Developer Guide</a></li>
          <li><a href="/guides/v2.2/pattern-library/bk-pattern.html">Admin Design Pattern Library</a></li>
          <li><a href="/guides/v2.2/design-styleguide/bk-styleguide.html">Admin Style Guide</a></li>
          <li><a href="https://magento-research.github.io/pwa-devdocs/">PWA Studios</a></li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title"><abbr>API</abbr></div>
        <ul>
          <li><a href="/guides/v2.2/get-started/bk-get-started-api.html">Get Started with Magento Web APIs</a></li>
          <li><a href="/guides/v2.2/rest/bk-rest.html">REST API Reference</a></li>
          <li><a href="/guides/v2.2/soap/bk-soap.html">SOAP API Reference</a></li>
          
          
          <li><a href="/guides/v2.2/marketplace/eqp/api.html">Marketplace EQP API Reference</a></li>
          
        </ul>
      </div>
    </div>

  </li>


  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Testing</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
        <li><a href="/guides/v2.2/test/testing.html">Magento Testing Guide</a></li>
        
        <li><a href="/guides/v2.2/magento-functional-testing-framework/release-2/introduction.html">Functional Acceptance Testing (New!)</a></li>
        
        <li><a href="/guides/v2.2/mtf/mtf_introduction.html">Functional Testing</a></li>
        <li><a href="/guides/v2.2/test/integration/integration_test_execution.html">Integration Testing</a></li>
        <li><a href="/guides/v2.2/test/js/jasmine.html">JavaScript Unit Testing</a></li>
        <li><a href="/guides/v2.2/test/unit/unit_test_execution.html">PHP Unit Testing</a></li>
        <li><a href="/guides/v2.2/get-started/web-api-functional-testing.html">Web API Functional Testing</a></li>
      </ul>
    </div>

  </li>


  <li class="nav-main-separator"></li>


  <li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Functional Areas</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
          
          <li class="leaf"><a href="/guides/v2.2/advanced-reporting/overview.html">Advanced Reporting</a></li>
          
        
        <li class="leaf"><a href="/guides/v2.2/b2b/bk-b2b.html">B2B</a></li>
        
        <li><a href="/guides/v2.2/howdoi/checkout/checkout_overview.html">Checkout</a></li>
        <li><a href="/guides/v2.2/payments-integrations/bk-payments-integrations.html">Payment Integrations</a></li>
        
          <li><a href="/guides/v2.2/extension-dev-guide/staging.html">Staging</a></li>
        
      </ul>
    </div>

  </li>


  <li class="nav-main-item"  tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Tutorials</span>

    <div class="nav-popup" role="menu" aria-hidden="true">
      <ul>
        <li><a href="/guides/v2.2/howdoi/bk-how-do-i.html">How To</a></li>
        
        <li><a  data-proofer-ignore href="/guides/v2.2/get-started/order-tutorial/order-intro.html">Order Processing with REST APIs</a></li>
        

        <li><a href="/videos/">Video Tutorials</a></li>
      </ul>
    </div>

  </li>

</ul><!-- /.nav-main -->

    </div>

    <div class="search-btn">
      <a class="search-trigger search-icon" href="#"></a>
    </div>

    <form class="quick-search" action="/guides/v2.2/search.html" method="get" novalidate="novalidate">
      <input type="search" name="q" placeholder="Search" />
      <a href="#" class="quick-search-close">&times;</a>
    </form>

  </div>

</nav><!-- #site-nav -->
<div class="nav-main-fader"></div>


	</header>

	<div class="global-wrapper">

		<div class="main-container">
			<a id="main-content"></a>


<div class="content-container">

    

	<!-- sidebar -->
<aside class="sidebar">
	<a href="#" data-proofer-ignore class="toc-toggler">Table of Contents</a>
	<div class="sidebar-wrapper">

		

		<h4 class="guide-title">Payment Provider Gateway</h4>
		<div class="collapsible-navigation">
		    <ul>
		    
		    	

<li class="nav-level1  " id="introduction">
    

    
    <a href="/guides/v2.2/payments-integrations/bk-payments-integrations.html">Introduction</a>
    

    
</li>


		    
		    	

<li class="nav-level1  " id="magento-payment-provider-gateway">
    

    
    <a href="/guides/v2.2/payments-integrations/payment-gateway/payment-gateway-intro.html">Magento payment provider gateway</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="payment-provider-gateway-structure">

            

            
            <a href="/guides/v2.2/payments-integrations/payment-gateway/payment-gateway-structure.html">Payment provider gateway structure</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="gateway-command">

            

            
            <a href="/guides/v2.2/payments-integrations/payment-gateway/gateway-command.html">Gateway Command</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="gateway-command-pool">

            

            
            <a href="/guides/v2.2/payments-integrations/payment-gateway/command-pool.html">Gateway Command Pool</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="request-builder">

            

            
            <a href="/guides/v2.2/payments-integrations/payment-gateway/request-builder.html">Request Builder</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="gateway-client">

            

            
            <a href="/guides/v2.2/payments-integrations/payment-gateway/gateway-client.html">Gateway Client</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="response-validator">

            

            
            <a href="/guides/v2.2/payments-integrations/payment-gateway/response-validator.html">Response Validator</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="response-handler">

            

            
            <a href="/guides/v2.2/payments-integrations/payment-gateway/response-handler.html">Response Handler</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2 active " id="error-code-mapping">

            

            
            <a href="/guides/v2.2/payments-integrations/payment-gateway/error-code-mapper.html">Error Code Mapping</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="adding-a-new-payment-integration-(payment-method)">
    

    
    <a href="/guides/v2.2/payments-integrations/base-integration/integration-intro.html">Adding a new payment integration (payment method)</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="payment-method-module-configuration">

            

            
            <a href="/guides/v2.2/payments-integrations/base-integration/module-configuration.html">Payment method module configuration</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="payment-method-configuration">

            

            
            <a href="/guides/v2.2/payments-integrations/base-integration/payment-option-config.html">Payment method configuration</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="payment-method-facade">

            

            
            <a href="/guides/v2.2/payments-integrations/base-integration/facade-configuration.html">Payment method facade</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="payment-info-rendering-in-admin-checkout">

            

            
            <a href="/guides/v2.2/payments-integrations/base-integration/formblocktype.html">Payment info rendering in Admin checkout</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="add-a-payment-action">

            

            
            <a href="/guides/v2.2/payments-integrations/base-integration/payment-action.html">Add a payment action</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="get-payment-information-from-frontend-to-backend">

            

            
            <a href="/guides/v2.2/payments-integrations/base-integration/get-payment-info.html">Get payment information from frontend to backend</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="configure-payment-method-by-area">

            

            
            <a href="/guides/v2.2/payments-integrations/base-integration/admin-integration.html">Configure payment method by area</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="adding-vault-integration">
    

    
    <a href="/guides/v2.2/payments-integrations/vault/vault-intro.html">Adding vault integration</a>
    

    
    <ul>
        
        
        
        <li class="nav-level2  " id="add-vault-to-module-dependencies">

            

            
            <a href="/guides/v2.2/payments-integrations/vault/module-configuration.html">Add vault to module dependencies</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="vault-payment-configuration">

            

            
            <a href="/guides/v2.2/payments-integrations/vault/vault-payment-configuration.html">Vault payment configuration</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="vault-di-configuration">

            

            
            <a href="/guides/v2.2/payments-integrations/vault/vault-di.html">Vault DI configuration</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="enable-vault">

            

            
            <a href="/guides/v2.2/payments-integrations/vault/enabler.html">Enable vault</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="payment-token">

            

            
            <a href="/guides/v2.2/payments-integrations/vault/payment-token.html">Payment Token</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="token-ui-component-provider">

            

            
            <a href="/guides/v2.2/payments-integrations/vault/token-ui-component-provider.html">Token UI component provider</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="display-the-stored-information">

            

            
            <a href="/guides/v2.2/payments-integrations/vault/customer-stored-payments.html">Display the stored information</a>
            

            
        </li>
        
        
        
        
        <li class="nav-level2  " id="vault-implementation-for-admin">

            

            
            <a href="/guides/v2.2/payments-integrations/vault/admin-integration.html">Vault implementation for Admin</a>
            

            
        </li>
        
        
    </ul>
    
</li>


		    
		    	

<li class="nav-level1  " id="signifyd-fraud-protection">
    

    
    <a href="/guides/v2.2/payments-integrations/signifyd/signifyd.html">Signifyd fraud protection</a>
    

    
</li>


		    
		    </ul>
		</div>

	</div>

</aside>
<!-- /sidebar -->


	<section class="content">
		<div class="content-wrap">
			<!-- page-header -->
<section class="page-intro">
	

  <nav class="breadcrumbs">

    <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      <li class="breadcrumb-item"><a class="breadcrumb-item" href="/"><span>Home</span></a></li>

    <!-- Iteration breadcrumb item -->
    
    

    

      <!-- Skip if root -->
      

      <!-- Get breadcrumb title -->
      

      <!-- SEO data -->
      

      <li class="breadcrumb-item active" property="itemListElement" typeof="ListItem">

        

          

          <span property="name">Error Code Mapping</span>

        

        <meta property="position" content="1" />
      </li>

    

    </ol>

  </nav>



	

	

	<h1 class="page-heading">Error Code Mapping</h1>

  


</section>

			<p>A payment gateway has error codes or messages that need to be transformed to user-friendly messages. When an error occurs, Magento  delivers the message to the appropriate audience so that the customer or merchant can resolve any problems. You can set up each payment integration to map the native error codes and messages into sets of text strings. As a result, you can ensure that only the proper audience (merchants only, customers only, or all) sees each error message. By default, the standard error message (<code class="highlighter-rouge">An error occurred on the server. Please try to place the order again.</code>) displays if a payment operation fails and a specific mapped message cannot be found.</p>

<p>Magento provides the <a href="https://github.com/magento/magento2/blob/2.2/app/code/Magento/Payment/Gateway/ErrorMapper/ErrorMessageMapperInterface.php"><code class="highlighter-rouge">\Magento\Payment\Gateway\ErrorMapper\ErrorMessageMapperInterface</code></a> interface and default mapper implementation at <a href="https://github.com/magento/magento2/blob/2.2/app/code/Magento/Payment/Gateway/ErrorMapper/ErrorMessageMapper.php"><code class="highlighter-rouge">\Magento\Payment\Gateway\ErrorMapper\ErrorMessageMapper</code></a> to enable customizations.</p>

<p>This topic uses examples based on the Magento Braintree payment integration to illustrate how to enable error code mapping.</p>

<h2 id="implement-mapping-files">Implement mapping files</h2>

<p>In most cases, you must define one or more mapping files and configure the default implementation of <code class="highlighter-rouge">ErrorMessageMapperInterface</code> using the module’s <code class="highlighter-rouge">di.xml</code> file. Alternatively, you can implement a programmatic solution described in <a href="#retrieve-errors">Retrieve error codes from the response validator</a>.</p>

<h3 id="map-the-messages">Map the messages</h3>

<p>The first step is to create one or more XML files that map message codes to messages. Magento recommends naming these files <code class="highlighter-rouge">&lt;gateway_name&gt;_error_mapping.xml</code>, but you can use any name you like. If you create more than one mapping file, each file must have the same file name. Use the following table to determine where to place mapping files:</p>

<table>
  <thead>
    <tr>
      <th>Audience</th>
      <th>location</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>All users</td>
      <td><code class="highlighter-rouge">&lt;module&gt;/etc</code></td>
    </tr>
    <tr>
      <td>Merchants</td>
      <td><code class="highlighter-rouge">&lt;module&gt;/adminhtml</code></td>
    </tr>
    <tr>
      <td>Customers</td>
      <td><code class="highlighter-rouge">&lt;module&gt;/frontend</code></td>
    </tr>
  </tbody>
</table>

<p>The files placed in the <code class="highlighter-rouge">adminhtml</code> and <code class="highlighter-rouge">frontend</code> directories ensure that customers and store administrators see only audience-specific messages. For example, a customer should see error messages when a credit card fails verfication due to mis-entered data and similar reasons. The store’s administrator should have more detailed descriptions of why an attempt to create an invoice or refund failed.</p>

<p>The  <a href="https://github.com/magento/magento2/blob/2.2/app/code/Magento/Braintree/etc/braintree_error_mapping.xml">braintree_error_mapping.xml</a> file provides an example  collection:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;mapping</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">"urn:magento:module:Magento_Payment:etc/error_mapping.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;message_list&gt;</span>
        <span class="nt">&lt;message</span> <span class="na">code=</span><span class="s">"81703"</span> <span class="na">translate=</span><span class="s">"true"</span><span class="nt">&gt;</span>Credit card type is not accepted by this merchant account.<span class="nt">&lt;/message&gt;</span>
        <span class="nt">&lt;message</span> <span class="na">code=</span><span class="s">"81706"</span> <span class="na">translate=</span><span class="s">"true"</span><span class="nt">&gt;</span>CVV is required.<span class="nt">&lt;/message&gt;</span>
        <span class="nt">&lt;message</span> <span class="na">code=</span><span class="s">"81707"</span> <span class="na">translate=</span><span class="s">"true"</span><span class="nt">&gt;</span>CVV must be 4 digits for American Express and 3 digits for other card types.<span class="nt">&lt;/message&gt;</span>
        ...
    <span class="nt">&lt;/message_list&gt;</span>
<span class="nt">&lt;/mapping&gt;</span>
</code></pre></div></div>

<p>The message definitions are based on the <a href="https://github.com/magento/magento2/blob/2.2/app/code/Magento/Payment/etc/error_mapping.xsd">error_mapping.xsd</a> schema. Messages must comply with the following structure:</p>

<ul>
  <li><code class="highlighter-rouge">message_list</code> — the root node. It can contain a list of specific messages</li>
  <li><code class="highlighter-rouge">message</code> — the node, which contains the customized message and two attributes
    <ul>
      <li><code class="highlighter-rouge">code</code> — the error code returned from the payment gateway. The value can be numeric or string</li>
      <li><code class="highlighter-rouge">translate</code> — a boolean attribute that determines whether to collect all message translations</li>
    </ul>
  </li>
</ul>

<h3 id="configure-dependency-injection">Configure dependency injection</h3>

<p>After you map the messages, you must specify the location of the error mapping file or files for the config reader. To do this, create a <code class="highlighter-rouge">virtualType</code> defintion for <code class="highlighter-rouge">\Magento\Payment\Gateway\ErrorMapper\VirtualConfigReader</code> in the module’s <code class="highlighter-rouge">di.xml</code> file:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;virtualType</span> <span class="na">name=</span><span class="s">"Magento\Braintree\Gateway\ErrorMapper\VirtualConfigReader"</span> <span class="na">type=</span><span class="s">"Magento\Payment\Gateway\ErrorMapper\VirtualConfigReader"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;arguments&gt;</span>
        <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"fileName"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>braintree_error_mapping.xml<span class="nt">&lt;/argument&gt;</span>
    <span class="nt">&lt;/arguments&gt;</span>
<span class="nt">&lt;/virtualType&gt;</span>
</code></pre></div></div>

<p>Also, specify a config instance for the data reader. You can also provide your own <code class="highlighter-rouge">cacheId</code>, which allows you to store all parsed messages in a cache.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;virtualType</span> <span class="na">name=</span><span class="s">"Magento\Braintree\Gateway\ErrorMapper\VirtualMappingData"</span> <span class="na">type=</span><span class="s">"Magento\Payment\Gateway\ErrorMapper\MappingData"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;arguments&gt;</span>
        <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"reader"</span> <span class="na">xsi:type=</span><span class="s">"object"</span><span class="nt">&gt;</span>Magento\Braintree\Gateway\ErrorMapper\VirtualConfigReader<span class="nt">&lt;/argument&gt;</span>
        <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"cacheId"</span> <span class="na">xsi:type=</span><span class="s">"string"</span><span class="nt">&gt;</span>braintree_error_mapper<span class="nt">&lt;/argument&gt;</span>
    <span class="nt">&lt;/arguments&gt;</span>
<span class="nt">&lt;/virtualType&gt;</span>
</code></pre></div></div>

<p>Then customize the default <code class="highlighter-rouge">ErrorMessageMapper</code> via virtual type and specify the data reader:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;virtualType</span> <span class="na">name=</span><span class="s">"Magento\Braintree\Gateway\ErrorMapper\VirtualErrorMessageMapper"</span> <span class="na">type=</span><span class="s">"Magento\Payment\Gateway\ErrorMapper\ErrorMessageMapper"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;arguments&gt;</span>
        <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"messageMapping"</span> <span class="na">xsi:type=</span><span class="s">"object"</span><span class="nt">&gt;</span>Magento\Braintree\Gateway\ErrorMapper\VirtualMappingData<span class="nt">&lt;/argument&gt;</span>
    <span class="nt">&lt;/arguments&gt;</span>
<span class="nt">&lt;/virtualType&gt;</span>
</code></pre></div></div>

<p>Because Braintree integration uses the default <a href="https://github.com/magento/magento2/blob/2.2/app/code/Magento/Payment/Gateway/Command/GatewayCommand.php"><code class="highlighter-rouge">Magento\Payment\Gateway\Command\GatewayCommand</code></a>,
inject the created mapper pool to the required <a href="/guides/v2.2/payments-integrations/payment-gateway/gateway-command.html">gateway command</a> as an argument:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;virtualType</span> <span class="na">name=</span><span class="s">"BraintreeAuthorizeCommand"</span> <span class="na">type=</span><span class="s">"Magento\Payment\Gateway\Command\GatewayCommand"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;arguments&gt;</span>
        ...
        <span class="nt">&lt;argument</span> <span class="na">name=</span><span class="s">"errorMessageMapper"</span> <span class="na">xsi:type=</span><span class="s">"object"</span><span class="nt">&gt;</span>Magento\Braintree\Gateway\ErrorMapper\VirtualErrorMessageMapper<span class="nt">&lt;/argument&gt;</span>
    <span class="nt">&lt;/arguments&gt;</span>
<span class="nt">&lt;/virtualType&gt;</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">Magento\Payment\Gateway\Command\GatewayCommand</code> allows you to retrieve multiple error messages, but if your integration
does not use this feature, you can inject <code class="highlighter-rouge">ErrorMessageMapperInterface</code> to it as an argument. Then implement your own logic to the mapper error codes.</p>

<p>The payment integration should now retrieve error codes from the payment gateway response.</p>

<h2 id="retrieve-errors">Retrieve error codes from the response validator</h2>

<p>You can retrieve errors codes using a <a href="/guides/v2.2/payments-integrations/payment-gateway/response-validator.html">response validator</a>.
A response validator verifies response codes from the payment gateway.
It has different responsibilities and should not map messages, because it works on the lower layer of communication between Magento and the payment gateway.
It is the responsibility of a gateway command to call an appropriate service.</p>

<p>For example, Magento provides a response validator for Braintree: <a href="https://github.com/magento/magento2/blob/2.2/app/code/Magento/Braintree/Gateway/Validator/GeneralResponseValidator.php"><code class="highlighter-rouge">\Magento\Braintree\Gateway\Validator\GeneralResponseValidator</code></a>.
Its implementation allows to add additional validators.</p>

<p>First, create a new validator. It can be a simple class with the <code class="highlighter-rouge">__invoke</code> method, because <code class="highlighter-rouge">GeneralResponseValidator</code> calls the validator as a function:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="k">class</span> <span class="nc">ErrorCodeValidator</span>
<span class="p">{</span>
    <span class="sd">/**
     * Invokes validation.
     *
     * @param Successful|Error $response
     * @return array
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__invoke</span><span class="p">(</span><span class="nv">$response</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$response</span> <span class="nx">instanceof</span> <span class="nx">Error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">[</span><span class="kc">true</span><span class="p">,</span> <span class="p">[</span><span class="nx">__</span><span class="p">(</span><span class="s1">'Transaction is successful.'</span><span class="p">)]];</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">[</span><span class="kc">false</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getErrorCodes</span><span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">errors</span><span class="p">)];</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Then add the created validator to a list of validators in the <code class="highlighter-rouge">GeneralResponseValidator</code> class:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="k">class</span> <span class="nc">GeneralResponseValidator</span> <span class="k">extends</span> <span class="nx">AbstractValidator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span>
        <span class="nx">ResultInterfaceFactory</span> <span class="nv">$resultFactory</span><span class="p">,</span>
        <span class="nx">SubjectReader</span> <span class="nv">$subjectReader</span><span class="p">,</span>
        <span class="nx">ErrorCodeValidator</span> <span class="nv">$errorCodeValidator</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">(</span><span class="nv">$resultFactory</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">subjectReader</span> <span class="o">=</span> <span class="nv">$subjectReader</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">errorCodeValidator</span> <span class="o">=</span> <span class="nv">$errorCodeValidator</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">getResponseValidators</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="k">function</span> <span class="p">(</span><span class="nv">$response</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="p">[</span>
                    <span class="nb">property_exists</span><span class="p">(</span><span class="nv">$response</span><span class="p">,</span> <span class="s1">'success'</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">success</span> <span class="o">===</span> <span class="kc">true</span><span class="p">,</span>
                    <span class="p">[</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">message</span> <span class="o">??</span> <span class="nx">__</span><span class="p">(</span><span class="s1">'Braintree error response.'</span><span class="p">)]</span>
                <span class="p">];</span>
            <span class="p">},</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">errorCodeValidator</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>You can also add the validator as an anonymous function, but a separate class is better for testing purposes.</p>

			
		</div>
		<!-- /.content-wrap -->

		<div class="page-info">

    
  
    
    <div class="github-link">
      <a class="improve-page" href="https://github.com/magento/devdocs/blob/develop/guides/v2.2/payments-integrations/payment-gateway/error-code-mapper.md" target="_blank">
        Edit this page on GitHub
      </a>
    </div>
    
  
    
    <div class="new-issue">
      <a href="https://github.com/magento/devdocs/issues/new?title=Feedback on page: /guides/v2.2/payments-integrations/payment-gateway/error-code-mapper.html" target="_blank">Give us feedback</a>
    </div>
    
  
  </div>

	</section>
	<!-- /.content -->

</div> <!-- /.content-container -->


	</div>
	<!-- /.main-container -->
</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div class="page-footer">
  <div class="container">

    <div class="copyright-links">
      <ul class="nav footer-links">
  <li><a href="/guides/v2.2/contributor-guide/contributing_docs.html">Become a Contributor</a>
  <li><a href="https://magento.github.io/glossary/index.html?audience=developer">Glossary</a></li>
  <li><a href="http://magento.com/legal/terms/privacy/">Privacy Policy</a></li>
  <li><a href="http://magento.com/legal/terms/">Terms of Service</a></li>
  <li><a href="http://magento.com/legal/licensing/">License/Trademark FAQ</a></li>
  <li><a href="/guides/v2.2/release-notes/bk-release-notes.html">Release Notes</a></li>
  <li><a href="/magento-third-party.html">Third-Party Licenses</a></li>
</ul>

    </div>

		<div class="copyright-date">&copy; 2018 Magento. All rights reserved.</div>

  </div>
</div>
<!-- / #footer -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="/assets/js/app.min.js"></script>


<script src="/common/js/devdocs.min.js"></script>



<script type="text/javascript">
    (function() {
        var didInit = false;
        function initMunchkin() {
            if(didInit === false) {
                didInit = true;
                Munchkin.init('585-GGD-959', {cookieAnon: false});
            }
        }
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.async = true;
        s.src = '//munchkin.marketo.net/munchkin.js';
        s.onreadystatechange = function() {
            if (this.readyState == 'complete' || this.readyState == 'loaded') {
                initMunchkin();
            }
        };
        s.onload = initMunchkin;
        document.getElementsByTagName('head')[0].appendChild(s);
    })();
</script>




</body>
</html>
